{"name":"barinek/flagship","tagline":"","body":"### Introduction\r\nThe **Flagship** project is inspired by the recent buzz around [twelve-factor applications](http://12factor.net) and [Microservices](http://12factor.net). The project is intended to show that it is fairly easy to build modern RESTful services with just a few dependencies.\r\n\r\nWhile building the service, I've highlighted a few characteristics of twelve-factor apps -\r\n\r\n* Explicitly declare and isolate dependencies\r\n* Store config in the environment\r\n* Exports HTTP as a service by binding to a port\r\n* Maximize robustness with fast startup and graceful shutdown\r\n* Stateless and share-nothing\r\n\r\nTwelve-factor apps aside, this example is slightly more inspired by the notion that everyone should understand how to build Microservices from scratch with just a few dependencies. Most of the recent server-side apps I've built tend to start with the basic concepts and app structure described below. There are also several open source projects that start with similar foundations; [Spring Boot](http://projects.spring.io/spring-boot/), [Netflix Pytheas] (https://github.com/Netflix/pytheas) and [Dropwizard](http://dropwizard.io/) are a few examples.\r\n\r\nUnderstanding the building blocks will help you understand your chosen framework. Additionally, I hope that it illustrates that there are a variety of options for each building block in the web stack. For example, the project uses Mybatis for data access although, could have just as easily use JPA or Spring JDBC templates.\r\n\r\nAs applications grow (multiple apps, multiple services), I'm also a slight fan of having all the services or components within large systems reside in a single, versioned repo although, I'll save that conversation for a future example.\r\n\r\n### Project Structure\r\nThe example walks you through a basic Java Microservice in a few steps. For discussion purposes, I've captured the steps via the below Git tags -\r\n\r\n```\r\ngit tag -ln\r\n\r\nv0.1            Initial App\r\nv0.2            Introducing Guice and App Environment\r\nv0.3            Introducing Jetty and Jersey\r\nv0.4            Introducing HealthChecks and Jackson\r\nv0.5            Basic persistence with MyBatis and MySQL\r\n```\r\n\r\n###  (v0.1) Initial App\r\n\r\nThe v0.1 tag starts with a simple Java class, App.java. The App includes both start and stop methods as well as an initial test class. The test class extends AppRunner which will be used for both integration and acceptance tests.\r\n\r\nI'm using Maven's pom file for dependency declaration and java -jar for dependency isolation. In fact, all the dependencies are \"vendored\" via maven within a single shaded jar.\r\n\r\nCurrent dependencies are slf4j and junit.\r\n\r\n###  (v0.2) Introducing Guice and App Environments\r\n\r\nv0.2 makes a slight nod to Agile web development and Rails by introducing Development, Test, and Production environments. The Environment class leverages both Java property files and local environment variables. Storing the config the environment is a characteristic of [twelve-factor apps](http://12factor.net/config).\r\n\r\n_I understand bundled environments are in slight contrast with twelve-factor apps although, I've found that using the 2 patterns in conjunction hasn't introduced config explosion or brittleness over the years._\r\n\r\nThe Environment is injected via Guice although, Spring would have worked just as easily. New dependencies include Guice.\r\n\r\n###  (v0.3) Introducing Jetty and Jersey\r\n\r\nI've used the Guice Servlet lib and Jersey's Guice contribs in conjunction with Jetty (Guice and Jersey) to stitch together the server component. I'll typically pull in Jetty (by habit) although, Netty and Tomcat are also great choices. Line 24 illustrates exporting HTTP as a service by binding to a port; in this case, Jetty is bound to port 8080.\r\n\r\nYou'll need to understand a bit about event listeners and filters - essentially the [servlet specification](https://jcp.org/aboutJava/communityprocess/final/jsr315/) - to fullly grasp the lines 24-25 in the App class. At a high level, the Listener class enables Jetty with Guice support and the ResourceModule class describes the available REST endpoints via classes and annotations. FWIW - I always recommend reading the servlet spec if you're a serious Java developer - or at a minimum having at least one person on your team that has read the spec ;)\r\n\r\nI've penciled in a RESTful NoopController that uses the javax.ws.rs package and simply returns plain text. The next tag will support the JSON media type. Note, the AppTest now becomes more interesting leveraging apache http components for acceptance tests which run via _mvn clean install_.\r\n\r\nThe new code allows for fast startup via embedded Jetty and a graceful shutdown via the Java's Runtime shutdown hook. New dependencies include Jersey and Jetty.\r\n\r\n###  (v0.4) Introducing HealthChecks and Jackson\r\n\r\nProduction support is always interesting - and, with a modern [PaaS](http://en.wikipedia.org/wiki/Platform_as_a_service), support becomes slightly easier. I've created a BasicHealthCheck to return app specific health; memory usage, connected sub-systems, etc. [JMX](http://en.wikipedia.org/wiki/Java_Management_Extensions) also works well although, the HealthCheck provides a nice step to introduce Jackson for JSON responses.\r\n\r\nNew dependencies include Jackson.\r\n\r\n###  (v0.5) Basic persistence with MyBatis and MySQL\r\n\r\nI've always enjoyed [MyBatis](http://blog.mybatis.org/). It's a data mapping tool that's a step below pulling in a full-blown O/RM.\r\n\r\nThe last tag includes a Project model, controller, and data access object. The test directory includes both integration and acceptance tests for the GET Projects endpoint. The README.md file includes manual instructions for setting up your local database. It also makes a few assumptions around naming conventions.\r\n\r\nNew dependencies include MyBatis and MySQL.\r\n\r\nThanks! (@barinek)\r\n\r\n_Thanks to (@dajulia3) for the copy edit_","google":"UA-61007704-1","note":"Don't delete this file! It's used internally to help with page regeneration."}