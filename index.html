<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="barinek/flagship : ">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>barinek/flagship</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/barinek/flagship">View on GitHub</a>

          <h1 id="project_title">barinek/flagship</h1>
          <h2 id="project_tagline"></h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/barinek/flagship/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/barinek/flagship/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h3>

<p>The Flagship project is inspired by the recent buzz around <a href="http://12factor.net">twelve-factor applications</a> and <a href="http://12factor.net">Microservices</a>. The project is intended to show that it is fairly easy to build modern RESTful services with just a few dependencies.</p>

<p>While building the app, I've tried to highlight a few notable characteristics of twelve-factor apps -</p>

<ul>
<li>Explicitly declare and isolate dependencies</li>
<li>Store config in the environment</li>
<li>Exports HTTP as a service by binding to a port</li>
<li>Maximize robustness with fast startup and graceful shutdown</li>
<li>Stateless and share-nothing</li>
</ul>

<p>Twelve-factor apps aside, this example is slightly more inspired by the notion that everyone should understand how to build Microservices from scratch with just a few dependencies. Most of the recent server-side apps I've built tend to start with the basic concepts and app structure described below. There are also several open source projects that start with similar foundations; <a href="http://projects.spring.io/spring-boot/">Spring Boot</a>, <a href="https://github.com/Netflix/pytheas">Netflix Pytheas</a> and <a href="http://dropwizard.io/">Dropwizard</a> are a few examples.</p>

<p>Understanding the building blocks will help you understand your chosen framework. Additionally, I hope that it illustrates that there are a variety of options for each building block in the web stack. For example, the project uses Mybatis for data access although, could have just as easily use JPA or Spring JDBC templates.</p>

<p>As applications grow (multiple apps, multiple services), I'm also a slight fan of having all the services or components within large systems reside in a single, versioned repo although, I'll save that conversation for a future example.</p>

<h3>
<a id="project-structure" class="anchor" href="#project-structure" aria-hidden="true"><span class="octicon octicon-link"></span></a>Project Structure</h3>

<p>The example walks you through a basic Java Microservice in a few steps. For discussion purposes, I've captured the steps via the below Git tags -</p>

<pre><code>git tag -ln

v0.1            Initial App
v0.2            Introducing Guice and App Environment
v0.3            Introducing Jetty and Jersey
v0.4            Introducing HealthChecks and Jackson
v0.5            Basic persistence with MyBatis and MySQL
</code></pre>

<h3>
<a id="v01-initial-app" class="anchor" href="#v01-initial-app" aria-hidden="true"><span class="octicon octicon-link"></span></a>(v0.1) Initial App</h3>

<p>The v0.1 tag starts with a simple Java class, App.java. The App includes both start and stop methods as well as an initial test class. The test class extends AppRunner which will be used for both integration and acceptance tests.</p>

<p>I'm using Maven's pom file for dependency declaration and java -jar for dependency isolation. In fact, all the dependencies are "vendored" via maven within a single shaded jar.</p>

<p>Current dependencies are slf4j and junit.</p>

<h3>
<a id="v02-introducing-guice-and-app-environments" class="anchor" href="#v02-introducing-guice-and-app-environments" aria-hidden="true"><span class="octicon octicon-link"></span></a>(v0.2) Introducing Guice and App Environments</h3>

<p>v0.2 makes a slight nod to Agile web development and Rails by introducing Development, Test, and Production environments. The Environment class leverages both Java property files and local environment variables. Storing the config the environment is a characteristic of <a href="http://12factor.net/config">twelve-factor apps</a>.</p>

<p>I understand bundled environments are in slight contrast with twelve-factor apps although, I've found that using the 2 patterns in conjunction hasn't introduced config explosion or brittleness over the years.</p>

<p>The Environment is injected via Guice although, Spring would have worked just as easily. New dependencies include Guice.</p>

<h3>
<a id="v03-introducing-jetty-and-jersey" class="anchor" href="#v03-introducing-jetty-and-jersey" aria-hidden="true"><span class="octicon octicon-link"></span></a>(v0.3) Introducing Jetty and Jersey</h3>

<p>I've used the Guice Servlet lib and Jersey's Guice contribs in conjunction with Jetty (Guice and Jersey) to stitch together the server component. I'll typically pull in Jetty (by habit) although, Netty and Tomcat are also great choices. Line 24 illustrates exporting HTTP as a service by binding to a port; in this case, Jetty is bound to port 8080.</p>

<p>You'll need to understand a bit about event listeners and filters - essentially the <a href="https://jcp.org/aboutJava/communityprocess/final/jsr315/">servlet specification</a> - to fullly grasp the lines 24-25 in the App class. At a high level, the Listener class enables Jetty with Guice support and the ResourceModule class describes the available REST endpoints via classes and annotations. FWIW - I always recommend reading the servlet spec if you're a serious Java developer - or at a minimum having at least one person on your team that has read the spec ;)</p>

<p>I've penciled in a RESTful NoopController that uses the javax.ws.rs package and simply returns plain text. The next tag will support the JSON media type. Note, the AppTest now becomes more interesting leveraging apache http components for acceptance tests which run via mvn clean install.</p>

<p>The new code allows for fast startup via embedded Jetty and a graceful shutdown via the Java's Runtime shutdown hook. New dependencies include Jersey and Jetty.</p>

<h3>
<a id="v04-introducing-healthchecks-and-jackson" class="anchor" href="#v04-introducing-healthchecks-and-jackson" aria-hidden="true"><span class="octicon octicon-link"></span></a>(v0.4) Introducing HealthChecks and Jackson</h3>

<p>Production support is always interesting - and, with a modern <a href="http://en.wikipedia.org/wiki/Platform_as_a_service">PaaS</a>, support becomes much easier. I've created a BasicHealthCheck to return app specific health; memory usage, connected sub-systems, etc. <a href="http://en.wikipedia.org/wiki/Java_Management_Extensions">JMX</a> also works well although, the HealthCheck provides a nice step to introduce Jackson for JSON responses.</p>

<p>New dependencies include Jackson.</p>

<h3>
<a id="v05-basic-persistence-with-mybatis-and-mysql" class="anchor" href="#v05-basic-persistence-with-mybatis-and-mysql" aria-hidden="true"><span class="octicon octicon-link"></span></a>(v0.5) Basic persistence with MyBatis and MySQL</h3>

<p>I've always enjoyed <a href="http://blog.mybatis.org/">MyBatis</a>. It's a data mapping tool that's a step below pulling in a full-blown O/RM.</p>

<p>The last tag includes a Project model, controller, and data access object. The test directory includes both integration and acceptance tests for the GET Projects endpoint. The README.md file includes manual instructions for setting up your local database. It also makes a few assumptions around naming conventions.</p>

<p>New dependencies include MyBatis and MySQL.</p>

<h3>
<a id="summary" class="anchor" href="#summary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Summary</h3>

<p>That's it for now. I hope the example helps and illustrates that you could create a twelve-factor microservice from scratch with a few basic dependencies.</p>

<p>Thanks! (<a href="https://github.com/barinek" class="user-mention">@barinek</a>) and thanks to (<a href="https://github.com/dajulia3" class="user-mention">@dajulia3</a>) for the copy edit!</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">barinek/flagship maintained by <a href="https://github.com/barinek">barinek</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-61007704-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
